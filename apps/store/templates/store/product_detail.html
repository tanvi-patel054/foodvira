{% extends 'store/base.html' %}

{% block title %}
{{ product.title }} | Product Details
{% endblock %}

{% block body %}

<section class="max-w-7xl mx-auto px-4 py-10">

  <!-- ================= GRID ================= -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">

    <!-- =====================================================
         LEFT COLUMN → STICKY IMAGE SECTION
    ====================================================== -->
    <div class="lg:sticky lg:top-24 self-start">

      <!-- Main Image -->
      <div class="bg-white rounded-xl shadow p-6">
        <img
          id="mainProductImage"
          src="{{ product.image.url }}"
          alt="{{ product.title }}"
          class="w-full h-[420px] object-contain rounded-lg"
        />
      </div>

      <!-- Thumbnails -->
      {% if product_images %}
      <div class="flex gap-3 mt-4 overflow-x-auto">
        {% for img in product_images %}
        <img
          src="{{ img.image.url }}"
          onclick="changeImage('{{ img.image.url }}')"
          class="w-20 h-20 object-cover rounded-lg border cursor-pointer hover:border-green-600"
          alt="{{ product.title }}"
        />
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- =====================================================
         RIGHT COLUMN → SCROLLING CONTENT
    ====================================================== -->
    <div class="space-y-10">

      <!-- Title -->
      <div>
        <h1 class="text-3xl font-bold text-gray-800">
          {{ product.title|title }}
        </h1>

        <p class="text-sm text-gray-500 mt-1">
          Category:
          <span class="font-medium">{{ product.category.name }}</span> |
          Unit:
          <span class="font-medium">{{ product.unit }}</span>
        </p>

        <div class="mt-4">
          <span class="text-3xl font-semibold text-green-600">
            ₹{{ product.price }}
          </span>
          <span class="line-through text-gray-400 ml-3">
            ₹{{ product.price|add:100 }}
          </span>
        </div>

        <p class="mt-2 text-sm">
          {% if product.stock > 0 %}
            <span class="text-green-600 font-medium">
              In Stock ({{ product.stock }} Kg available)
            </span>
          {% else %}
            <span class="text-red-600 font-medium">
              Out of Stock
            </span>
          {% endif %}
        </p>

        {% if product.content %}
        <div class="mt-4 text-gray-600 leading-relaxed">
          {{ product.content|linebreaks }}
        </div>
        {% endif %}
      </div>

      <!-- ================= SPECIFICATIONS ================= -->
      {% if product.additional_details %}
      <div>
        <h2 class="text-xl font-bold text-gray-800 mb-4">
          Product Specifications
        </h2>

        <div class="overflow-hidden border rounded-xl">
          <table class="w-full text-sm">
            <tbody>
              {% for key, value in product.additional_details.items %}
              <tr class="border-b last:border-none">
                <td class="px-4 py-3 font-medium bg-gray-50 w-1/3">
                  {{ key }}
                </td>
                <td class="px-4 py-3 text-gray-600">
                  {{ value }}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endif %}

      <!-- ================= INQUIRY FORM ================= -->
      <div class="bg-white border rounded-2xl shadow p-8">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">
          Product Inquiry
        </h2>

        <form method="post" action="{% url 'product_inquiry' %}" class="space-y-5">
          {% csrf_token %}
          <input type="hidden" name="product_id" value="{{ product.id }}">

          <div>
            <label class="block text-sm font-medium mb-1">Your Name</label>
            <input
              type="text"
              name="name"
              required
              class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none" placeholder="Jhon Doe"
            >
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Mobile Number</label>
            <input
              type="tel"
              name="mobile"
              required
              class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none" placeholder="(+XXX XXXXXXXXXX)"
            >
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Quantity Required</label>
            <input
              type="text"
              name="quantity"
              placeholder="e.g. 10 Kg"
              class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none"
            >
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Message</label>
            <textarea
              name="message"
              rows="4"
              class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none" placeholder="Write your specific requirement"
            ></textarea>
          </div>

          <button
            type="submit"
            class="w-full bg-green-600 text-white py-3 rounded-xl font-semibold hover:bg-green-700" 
          >
            Submit Inquiry
          </button>
        </form>
      </div>

    </div>
  </div>
  <!-- ================= RELATED PRODUCTS ================= -->
{% if related_products %}
<div class="mt-20">
  <h2 class="text-2xl font-bold text-gray-800 mb-8">
    Related Products
  </h2>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

    {% for item in related_products %}
    <div class="bg-white border rounded-xl shadow-sm hover:shadow-md transition p-4">

      <a href="{% url 'product_detail' product_id=item.id %}">
        <img
          src="{{ item.image.url }}"
          alt="{{ item.title }}"
          class="w-full h-48 object-contain rounded-lg"
        >
      </a>

      <div class="mt-4">
        <p class="text-xs text-gray-500 uppercase tracking-wide">
          {{ item.category.name }}
        </p>

        <a
          href="{% url 'product_detail' product_id=item.id %}"
          class="block text-lg font-semibold text-gray-800 hover:text-green-600"
        >
          {{ item.title }}
        </a>

        <p class="mt-1 font-semibold text-green-600">
          ₹{{ item.price }}
        </p>
      </div>

    </div>
    {% endfor %}

  </div>
</div>
{% endif %}

</section>



<!-- ================= IMAGE SWITCH JS ================= -->
<script>
  function changeImage(url) {
    document.getElementById('mainProductImage').src = url;
  }
</script>

{% endblock %}
